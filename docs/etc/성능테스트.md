# 성능 테스트

> 성능 테스트에 대해 아는바가 없어 최대한 많은 블로그들을 참고하여 개념을 익히려 하였습니다.
> 

🛠 ****[pinpoint & ngrinder 삽질 기록](https://velog.io/@gkdud583/pinpoint-ngrinder-%EC%82%BD%EC%A7%88-%EA%B8%B0%EB%A1%9D)****

**ngrinder & pinpoint 병목 지점 파악 후 개선** 

→ 자주 사용되지만 쉽게 변경되지 않는 데이터라면 캐싱을 해서 성능 향상를 고려하자. 캐시할수 없는 상황이라면

현재 실행된 쿼리의 실행계획을 통해 index를 타는지 확인하고 역정규화나 slave db를 늘리거나 db성능에 맞춰 커넥션 풀 사이즈를 조정하는 방법도 있음.

[Ngrinder로 성능을 테스트 후 캐시로 성능 올리기](https://shrewd.tistory.com/m/50)

[nGrinder와 Pinpoint를 이용한 성능 / 부하 테스트1 - 테스트 계획](https://velog.io/@max9106/nGrinderPinpoint-test1)

[](https://www.whatap.io/ko/blog/14/)

[nGrinder + Springboot 부하 테스트 튜토리얼](https://leezzangmin.tistory.com/42)

[트렌비 리뷰 서비스의 성능 개선기 - 트렌비 기술블로그](https://tech.trenbe.com/2022/09/14/%ED%8A%B8%EB%A0%8C%EB%B9%84-%EB%A6%AC%EB%B7%B0-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%9D%98-%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B0.html)

[nGrinder를 이용해 Login API 성능 테스트 후 scale-out을 적용하여 성능 개선 - (1)](https://junghyungil.tistory.com/175)

[nGrinder로 성능 테스트 과정에서 발견한 Redis Session 병목](https://liasn.tistory.com/7)

[[서버개발캠프] 인증 서버 - 로그인 성능 테스트 : nGrinder](https://yunb2.tistory.com/8)

[결제 시스템 성능, 부하, 스트레스 테스트 | 우아한형제들 기술블로그](https://techblog.woowahan.com/2572/)

---

## 🏃‍♀️ 중요한 부분 요약 정리

🌟 **부하 테스트시 중요한 지표**

- Users: 동시에 사용할 수 있는 사람
- TPS: 일정 시간 동안 얼마나 처리할 수 있는지
    - 한 명만 사용해도 처리량이 좋지 않으면 → scale up
    - 부하 증가시 문제 → scale out
- Time: 얼마나 빠른지

> 테스트 환경은 실제 사용자가 접속하는 환경과 유사해야 한다. 데이터도 양도 동일해야 함.
> 

---

📍**테스트 수립**

- 테스트 target을 정한다.

ex)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8d5e2f4c-2789-4829-a7aa-37e8e0641bc1/Untitled.png)

- 데이터 수

서비스 이용자 수, 사용자의 행동 패턴, 사용 기간등을 고려하여 계산한다.

신규 서비스의 경우 임의로 데이터 수를 정하고 테스트할수 있다.

ex)

주요 api 를 테스트하고 각 테이블에 20만개의 더미 데이터를 넣고 진행한다.

- 목표값에 대한 성능 유지시간

ex)

주요 기능의 성능이 30분동안 유지되는것을 목표로 테스트 & 개선

✅ **테스트 종류**

정확한 평균 수치를 산출하기 위해 테스트 시간은 10분 이상 잡는 걸 추천

- smoke 테스트
    - vuser: 1~2
    - **최소의 부하로 시나리오를 검증해보자.**
- load 테스트
    - **평소 트래픽과 최대 트래픽일때 vuser를 계산 후 시나리오를 검증해보자.**
    - 결과에 따라 개선해보면서 테스트를 반복한다.
- stress 테스트
    - 최대 사용자 혹은 최대 처리량인 경우의 **한계점을 확인하는 테스트**
    - 점진적으로 부하를 증가시켜보자.
    - **테스트 이후 시스템이 수동 개입 없이 자동 복구되는지 확인해보자.**

🔎 **성능 목표 설정**

load 테스트의 경우 vuser를 구해야 한다.

vuser를 구하기 위해선 다음의 지표들이 필요하다.

- DAU(일일 활동 사용자 수)
- 피크 시간대 집중률(최대 트래픽 / 평소 트래픽)
- 1명당 1일 평균 요청 수

신규 서비스의 경우 [similarweb](https://www.similarweb.com/)을 활용해서 비슷한 서비스의 트래픽을 보고 지표를 가정할 수 있음.

🛠 **ngrinder**

- TPS, MTT를 중점적으로 살펴보면 된다.
- **TPS: 초당 몇 번의 테스트가 일어났는지를 뜻함.**
- 이상적으로 TPS는 VUser가 증가하는것에 비례해서 늘어남.
- 그러다가 어느 시점에 TPS가 더 이상 증가하지 않게 되는데 이 지점에 도달하는 순간 사용자의 응답 시간에 영향을 미치게 된다. ← 처리량은 그대로인데 요청수는 많아지니 응답시간이 증가 (이 지점에서 오히려 TPS가 떨어질 수도 있는데 이 경우 서버 튜닝이 제대로 되지 않은 것)
- **MTT: 한 번의 요청이 응답까지 몇 초가 걸렸는지를 나타냄.**
    
    실제 서비스에서는 응답 시간을 최소 1초 이하로 줄여야 한다.
    
    즉각적인 응답으로 인식되는 응답 시간은 0.1초 (100ms) 이내
    
    ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d059d4c6-5e3c-4b22-ad3e-fcddc52a47aa/Untitled.png)
    

[참고]([https://tech.trenbe.com/2022/09/14/트렌비-리뷰-서비스의-성능-개선기.html](https://tech.trenbe.com/2022/09/14/%ED%8A%B8%EB%A0%8C%EB%B9%84-%EB%A6%AC%EB%B7%B0-%EC%84%9C%EB%B9%84%EC%8A%A4%EC%9D%98-%EC%84%B1%EB%8A%A5-%EA%B0%9C%EC%84%A0%EA%B8%B0.html))